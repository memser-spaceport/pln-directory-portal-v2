'use client';

import React, { useEffect } from 'react';
import { Menu } from '@base-ui-components/react/menu';

import { usePathname, useRouter } from 'next/navigation';
import s from './ItemMenu.module.scss';

export const ItemMenu = ({ onEdit }: { onEdit?: () => void }) => {
  const router = useRouter();
  const pathname = usePathname();

  useEffect(() => {
    router.prefetch(`${pathname}/edit`);
  }, [pathname, router]);

  return (
    <Menu.Root modal={false}>
      <Menu.Trigger className={s.Button}>
        <div className={s.ButtonIcon}>
          <MenuIcon />
        </div>
      </Menu.Trigger>
      <Menu.Portal>
        <Menu.Positioner className={s.Positioner} align="end">
          <Menu.Popup className={s.Popup}>
            <Menu.Item
              className={s.Item}
              onClick={() => {
                if (onEdit) {
                  onEdit();
                } else {
                  router.push(`${pathname}/edit`);
                }
              }}
            >
              <EditIcon /> Edit
            </Menu.Item>
          </Menu.Popup>
        </Menu.Positioner>
      </Menu.Portal>
    </Menu.Root>
  );
};

const MenuIcon = () => (
  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path
      d="M12.9201 18.86C13.1601 18.62 13.3001 18.29 13.3001 17.94C13.3001 17.68 13.2201 17.43 13.0801 17.22C12.9401 17.01 12.7301 16.84 12.5001 16.74C12.2601 16.64 12.0001 16.62 11.7501 16.67C11.5001 16.72 11.2701 16.84 11.0901 17.03C10.9101 17.21 10.7801 17.44 10.7301 17.69C10.6801 17.94 10.7101 18.2 10.8001 18.44C10.9001 18.68 11.0601 18.88 11.2801 19.02C11.4901 19.16 11.7401 19.24 12.0001 19.24C12.3401 19.24 12.6701 19.1 12.9201 18.86Z"
      fill="#455468"
    />
    <path
      d="M13.3001 12C13.3001 11.74 13.2201 11.49 13.0801 11.28C12.9401 11.07 12.7301 10.9 12.5001 10.8C12.2601 10.7 12.0001 10.68 11.7501 10.73C11.5001 10.78 11.2701 10.9 11.0901 11.09C10.9101 11.27 10.7801 11.5 10.7301 11.75C10.6801 12 10.7101 12.26 10.8001 12.5C10.9001 12.74 11.0601 12.94 11.2801 13.08C11.5001 13.22 11.7401 13.3 12.0001 13.3C12.3401 13.3 12.6701 13.16 12.9201 12.92C13.1601 12.68 13.3001 12.35 13.3001 12Z"
      fill="#455468"
    />
    <path
      d="M13.3001 6.06002C13.3001 5.80002 13.2201 5.55002 13.0801 5.34002C12.9401 5.13002 12.7301 4.96002 12.5001 4.86002C12.2601 4.76002 12.0001 4.74002 11.7501 4.79002C11.5001 4.84002 11.2701 4.96002 11.0901 5.15002C10.9101 5.33002 10.7801 5.56002 10.7301 5.81002C10.6801 6.06002 10.7101 6.32002 10.8001 6.56002C10.8901 6.80002 11.0601 7.00002 11.2801 7.14002C11.4901 7.28002 11.7401 7.36002 12.0001 7.36002C12.3401 7.36002 12.6701 7.22002 12.9201 6.98002C13.1601 6.74002 13.3001 6.41002 13.3001 6.06002Z"
      fill="#455468"
    />
  </svg>
);

const EditIcon = () => (
  <svg width="14" height="15" viewBox="0 0 14 15" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path
      d="M12.8789 1.35156L13.3984 1.87109C14 2.47266 14 3.42969 13.3984 4.03125L12.5781 4.85156L9.89844 2.17188L10.7188 1.35156C11.3203 0.75 12.2773 0.75 12.8789 1.35156ZM4.70312 7.36719L9.26953 2.80078L11.9492 5.48047L7.38281 10.0469C7.21875 10.2109 7 10.3477 6.78125 10.4297L4.34766 11.2227C4.12891 11.3047 3.85547 11.25 3.69141 11.0586C3.5 10.8945 3.44531 10.6211 3.52734 10.4023L4.32031 7.96875C4.40234 7.75 4.53906 7.53125 4.70312 7.36719ZM2.625 2.5H5.25C5.71484 2.5 6.125 2.91016 6.125 3.375C6.125 3.86719 5.71484 4.25 5.25 4.25H2.625C2.13281 4.25 1.75 4.66016 1.75 5.125V12.125C1.75 12.6172 2.13281 13 2.625 13H9.625C10.0898 13 10.5 12.6172 10.5 12.125V9.5C10.5 9.03516 10.8828 8.625 11.375 8.625C11.8398 8.625 12.25 9.03516 12.25 9.5V12.125C12.25 13.5742 11.0742 14.75 9.625 14.75H2.625C1.17578 14.75 0 13.5742 0 12.125V5.125C0 3.67578 1.17578 2.5 2.625 2.5Z"
      fill="#64748B"
    />
  </svg>
);
