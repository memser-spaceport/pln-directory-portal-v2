name: Deploy to Develop

on:
  push:
    branches:
      - develop

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Check if user should trigger deployment
        id: check_user
        run: |
          # Load the list of users from the secret
          USERS_WITH_VERCEL_ACCESS="${{ secrets.VERCEL_USER_ACCESS_LIST }}"
          
          # Convert the string to an array (split by comma)
          IFS=',' read -r -a USER_ARRAY <<< "$USERS_WITH_VERCEL_ACCESS"
          
          # Check if the current user is in the list
          if [[ " ${USER_ARRAY[@]} " =~ " ${GITHUB_ACTOR} " ]]; then
            echo "User ${GITHUB_ACTOR} has Vercel access. Skipping deployment."
            echo "should_trigger=false" >> $GITHUB_ENV
          else
            echo "User ${GITHUB_ACTOR} does not have Vercel access. Proceeding with deployment."
            echo "should_trigger=true" >> $GITHUB_ENV
          fi

      - name: Trigger Vercel deployment hook
        if: env.should_trigger == 'true'
        run: |
          curl -X POST ${{ secrets.FRONTEND_DIRECTORY_PORTAL_DEV_DEPLOY_HOOK }}